---
layout: article
title: 分布式系统课程笔记
key: distributed-systems-notes
tags: DistributedSystems CourseNotes
---

分布式系统课程笔记

<!-- more -->

分布式系统简介
===========

分布式系统表现形式
--------------

* 集群

* 网格（分布式资源分布管理）
    * 计算和数据网格
    * P2P 网格
        * 不可信用户资源
        * 泛式类比云计算-边缘计算
    * 对等网络
        * 节点机器都是简单地接入互联网地客户机，不存在主从关系
        * 覆盖网络：基于通信或文件共享需求，对等节点 ID 在逻辑层形成一个覆盖网络
        * 异构：硬件模型/体系结构、软件/操作系统、网络连接/协议
            * 因此多在应用层实现网络

    > __P2P 网络设计目标：__ 数据局部性、网络邻近性、互操作性

* 云计算（分布式资源集中管理）
    * 通过迅速系统虚拟机或物理机，允许负载被快速配置和划分
    * 平台比较同构化
    * 支持冗余、自恢复、高可扩展编程模型
    * 服务模型：IaaS、PaaS、SaaS

分布式系统设计目标
--------------

* 资源可访问
* 透明性
    * 访问、位置、迁移、复制、并发、故障
* 开放性
    * 完整且中立的接口
    * 互操作性
    * 策略与机制分离
* 可扩展性
    * 规模：更多用户和资源的加入
    * 地域：多地容灾
    * 管理：跨独立机构仍可管理

分布式系统性能度量
--------------

* 与许多因素相关
    * 吞吐量、作业相应时间、网络延迟……
* 系统开销通常归因于操作系统启动时间、编译时间、I/O 数据速率、运行时支持系统消耗
* QoS、系统可用性/可靠性、安全弹性……

分布式系统设计关键技术
-----------------

* 通信
    * 分层通信协议
        * 中间件协议
            * 第五层，应用层与传输层之间
            * 用于支持高层应用系统通信的协议
* 同步
* 一致性
* 容错
* 安全性
* 分布式共享内存
* 分布式文件系统
* 分布式数据管理
* 流数据与流处理
* 虚拟化

同步
--- 

* 数据为中心的一致性模型
    * 顺序一致性
    * 因果一致性
* 用户为中心的一致性模型
    * 最终一致性
    * 单调读
    * 单调写

容错
---

* 可用性 Availability
    * 系统可以正确操作运行
    * 系统在任何给定的时间都是可响应的
* 可靠性 Reliability (MTTF)
    * 系统可以无故障的持续运行
* 安全性 Safety
    * 系统偶然故障的情况能正常操作而不出现任何灾难
* 可维护性 Maintainability (MTTR)
    * 发生故障的系统被恢复的难易程度
* 分区容忍性 Partitoin tolerance
    * 将宕掉的机器和正常机器进行分区，正常机器分区仍然能够满足一致性和可用性
    * 分区不是绝对的，是有时效性的

> __CAP 定理：__ 三选二


分布式通讯
========

__形式__

* 远程过程调用
* 基于消息的通讯
* 流式通讯
* 多播通讯

__通讯的类型__

* 非易失 persistent / 暂存 transient
* 同步 synchronous / 异步 asynchronous
* 离散 discrete / 连续 stream

e.g.

* E-mail 非易失+同步
* RPC 暂存+同步
    * 异步 RPC、两阶段异步 RPC

__基于消息的通讯__

_与 RPC 方式全由底层负责消息转换不同，由用户参与，性能优化可能_

* 暂存（存于如 TCP/IP 协议栈中）
    * 基于 TCP/IP socket 接口通讯
    * 基于 MPI 通讯
        * 屏蔽 socket 编程细节
        * 通过不同接口开放不同的同步/异步粒度
* 非易失
    * 消息队列、消息中间件

__流式通讯__

* 特点
    * 依赖时间信息
    * 实时/准实时通讯
* 问题
    * QoS
    * 流同步

__多播通讯__

* 层叠网络 overlay network（应用层）
    * Tree, Mesh, DHT / P2P
* 流言传播
    * 增熵消息传播模型
    * 最有效的消息传播模型，需要避免将信息重复传递给已经接收到最新消息的节点


分布式并发控制与一致性
==================

* 并发
    * 同一时间 __段__ 内可以同步执行
    * $$a \not\lt_{hb} b, b \not\lt_{hb} a \Rightarrow a || b$$
* 一致性
    * 一致的数据 __视图__

并发时序
-------

__逻辑时钟（Lamport 时钟）__

_偏序关系_

1. 节点内事件发生：$$L_i = L_i + 1$$
2. 发送：$$t = L_i,\ send(msg, t)$$
3. 接收：$$recv(msg, t),\ L_i=\max{(L_i,t)} + 1$$

hb 关系（Happen-Before 关系）决定时间关系，时间关系 __无法__ 决定 hb 关系。

* $$a \lt_{hb} b \Rightarrow L(a) \lt L(b)$$，反之不亦然
* $$L(a) || L(b) \Rightarrow a || b$$，反之不亦然

__全序逻辑时钟（向量时钟）__

时间戳：标号与进程号 $$(t_i, i)$$

$$a \lt_{hb} b \Leftrightarrow t_i \lt t_j\ or\ t_i=t_j, i<j$$

$$a \lt_{hb} b \Leftrightarrow Vec(a) \lt Vec(b)$$

对每个节点 $$n_i$$ 上的向量时钟：
1. 初始化：$$V_i[j] = 0$$
2. 节点内事件发生：$$V_i[i] = V_i[i] + 1$$
3. 发送：$$send(msg, t=V_i)$$
4. 接收：$$V_j=\max{(V_j, t)},\ V_j[j] = V_j[j] +1$$
